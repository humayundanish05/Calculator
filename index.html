DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dark Galactic Scientific Calculator</title>
    <style>
Calculator — style.css
   Neon-accented dark theme, responsive, touch + keyboard friendly,
   multi-line expression, history & memory panels, clear visual hierarchy.
*/

/* Basic reset */
* { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
html, body, #app { height: 100%; }
body {
  background: linear-gradient(180deg, #070709 0%, #050408 60%);
  color: #e6eef8;
  font-family: "Inter", system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  padding: 18px;
}

/* Optional neon font if present */
@font-face {
  font-family: "NeonUI";
  src: url("assets/neon-font.woff2") format("woff2");
  font-weight: 400;
  font-style: normal;
  font-display: swap;
}

/* App layout */
#app {
  display: grid;
  grid-template-columns: 1fr 340px;
  grid-template-rows: auto 1fr;
  gap: 18px;
  max-width: 1200px;
  margin: 0 auto;
  min-height: 720px;
}

/* Display container spans left column full height */
#display-container {
  grid-column: 1 / 2;
  grid-row: 1 / 3;
  background: linear-gradient(180deg, rgba(30,30,40,0.35), rgba(8,8,10,0.25));
  border-radius: 14px;
  padding: 18px;
  display: flex;
  flex-direction: column;
  gap: 12px;
  box-shadow:
    0 8px 24px rgba(0,0,0,0.7),
    0 0 40px rgba(0,255,200,0.02) inset;
  backdrop-filter: blur(6px);
  border: 1px solid rgba(255,255,255,0.03);
}

/* Expression area (multi-line) */
#expression-display {
  width: 100%;
  min-height: 160px;
  max-height: 280px;
  background: transparent;
  color: #dffaff;
  font-family: "NeonUI", "Inter", monospace;
  font-size: 18px;
  line-height: 1.38;
  padding: 14px;
  border-radius: 10px;
  border: 1px solid rgba(255,255,255,0.03);
  outline: none;
  resize: vertical;
  caret-color: #00ffd2;
  box-shadow: 0 6px 30px rgba(0,0,0,0.6);
}

/* Result display — precise, big and neon */
#result-display {
  min-height: 84px;
  max-height: 220px;
  overflow: auto;
  padding: 12px 14px;
  border-radius: 10px;
  background: linear-gradient(180deg, rgba(0,0,0,0.28), rgba(8,8,12,0.3));
  border: 1px solid rgba(0,255,200,0.06);
  font-family: "NeonUI", "Inter", monospace;
  font-size: 20px;
  color: #bffdf0;
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 12px;
  white-space: pre-wrap;
  word-break: break-word;
}

/* Neon accent glow line */
#result-display::before {
  content: "";
  height: 2px;
  width: 100%;
  display: block;
  background: linear-gradient(90deg, rgba(0,255,200,0.0), rgba(0,255,200,0.12), rgba(0,255,200,0.0));
  margin-bottom: 8px;
}

/* Right column panels: history + memory + keypad stacked */
#history-panel, #memory-panel {
  background: linear-gradient(180deg, rgba(10,10,12,0.6), rgba(6,6,8,0.45));
  border-radius: 12px;
  border: 1px solid rgba(255,255,255,0.03);
  padding: 12px;
  box-shadow: 0 6px 18px rgba(0,0,0,0.6);
}

/* Place the panels in column */
#history-panel { grid-column: 2 / 3; grid-row: 1 / 2; }
#memory-panel { grid-column: 2 / 3; grid-row: 2 / 3; display: flex; flex-direction: column; gap: 10px; }

/* Panel titles */
#history-title, #memory-title {
  font-size: 12px;
  letter-spacing: 1.8px;
  color: rgba(160,255,230,0.9);
  font-weight: 700;
  text-transform: uppercase;
  margin-bottom: 8px;
  font-family: "NeonUI", "Inter", sans-serif;
}

/* History list */
#history-list, #memory-list {
  background: rgba(0,0,0,0.12);
  border-radius: 8px;
  padding: 8px;
  min-height: 120px;
  max-height: 420px;
  overflow: auto;
  color: #cfeff0;
  font-size: 14px;
}

/* Each history item */
.history-item {
  display: flex;
  justify-content: space-between;
  gap: 8px;
  padding: 8px;
  margin-bottom: 6px;
  border-radius: 6px;
  transition: transform 0.12s ease, background 0.12s ease;
  cursor: pointer;
}
.history-item:hover { transform: translateX(6px); background: rgba(0,255,200,0.02); }
.history-item .expr { color: #9feee2; font-family: monospace; font-size: 13px; opacity: 0.95; }
.history-item .value { color: #eafff7; font-weight: 700; font-family: "NeonUI", monospace; }

/* Memory controls layout */
#memory-controls { display:flex; gap:8px; }
.mem-btn {
  flex: 1;
  background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
  border: 1px solid rgba(0,255,200,0.06);
  padding: 8px 10px;
  border-radius: 8px;
  font-weight: 700;
  cursor: pointer;
  color: #c9fff4;
  transition: transform 0.08s ease, box-shadow 0.12s ease;
}
.mem-btn:active { transform: translateY(2px); box-shadow: 0 6px 18px rgba(0,255,200,0.03) inset; }

/* Keypad area (large control area) */
#keypad {
  grid-column: 1 / 3;
  grid-row: 3 / 4;
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 12px;
  margin-top: 12px;
  background: transparent;
}

/* Buttons base style */
.btn {
  user-select: none;
  -webkit-user-select: none;
  padding: 18px 10px;
  border-radius: 12px;
  font-weight: 700;
  font-size: 18px;
  border: 1px solid rgba(255,255,255,0.03);
  background: linear-gradient(180deg, rgba(12,12,16,0.6), rgba(6,6,8,0.3));
  color: #e7fbf5;
  cursor: pointer;
  box-shadow: 0 8px 22px rgba(0,0,0,0.6);
  transition: transform 0.08s ease, box-shadow 0.12s ease, background 0.12s ease;
  display: inline-flex;
  align-items: center;
  justify-content: center;
}

/* Visual variants */
.btn.num { font-family: monospace; }
.btn.op { color: #e9ffd9; border: 1px solid rgba(0,255,150,0.06); }
.btn.fn { color: #ffdbe6; border: 1px solid rgba(255,50,200,0.04); }
.btn.eq {
  grid-column: span 2;
  background: linear-gradient(90deg, rgba(0,255,200,0.12), rgba(0,200,255,0.06));
  color: #001a0f;
  border: 1px solid rgba(0,255,200,0.14);
  box-shadow: 0 18px 40px rgba(0,255,200,0.06);
}

/* Button interaction */
.btn:active { transform: translateY(3px) scale(0.998); box-shadow: 0 6px 12px rgba(0,0,0,0.7) inset; }
.btn:focus { outline: none; box-shadow: 0 0 24px rgba(0,255,200,0.08); }

/* Small screens & responsive behavior */
@media (max-width: 980px) {
  #app { grid-template-columns: 1fr; grid-template-rows: auto auto auto; padding: 12px; }
  #history-panel { grid-column: 1 / 2; grid-row: 2 / 3; }
  #memory-panel { grid-column: 1 / 2; grid-row: 3 / 4; }
  #display-container { grid-column: 1 / 2; grid-row: 1 / 2; }
  #keypad { grid-column: 1 / 2; grid-row: 4 / 5; grid-template-columns: repeat(4, 1fr); margin-top: 10px; }
  #result-display { font-size: 18px; }
  #expression-display { min-height: 120px; font-size: 16px; }
}

/* Micro-typography for scientific notation & units */
.unit, .const {
  font-family: "NeonUI", monospace;
  color: rgba(160,255,230,0.92);
  font-weight: 700;
  letter-spacing: 0.6px;
  background: linear-gradient(90deg, rgba(0,0,0,0.0), rgba(0,255,200,0.02));
  padding: 2px 6px;
  border-radius: 6px;
}

/* Error visuals */
.result-error {
  color: #ffd7d7;
  background: rgba(255,10,10,0.03);
  border: 1px solid rgba(255, 10, 10, 0.08);
  box-shadow: 0 8px 22px rgba(255, 0, 0, 0.02) inset;
}

/* Tooltip / hint bubbles */
.hint {
  font-size: 12px;
  opacity: 0.85;
  color: rgba(200,240,230,0.8);
}

/* Accessibility focus ring */
:focus-visible {
  outline: 2px solid rgba(0,255,200,0.14);
  outline-offset: 2px;
}

/* Small helper for compact keypad rows (used by advanced expanded UI) */
.key-row { display: flex; gap: 8px; }

/* Scrollbar styling for panels */
#history-list::-webkit-scrollbar, #memory-list::-webkit-scrollbar, #result-display::-webkit-scrollbar {
  height: 8px; width: 8px;
}
#history-list::-webkit-scrollbar-thumb, #memory-list::-webkit-scrollbar-thumb, #result-display::-webkit-scrollbar-thumb {
  background: linear-gradient(180deg, rgba(0,255,200,0.08), rgba(0,255,200,0.02));
  border-radius: 8px;
}

/* Responsive scaling for very small devices */
@media (max-width: 420px) {
  .btn { padding: 14px 8px; font-size: 16px; border-radius: 10px; }
  #expression-display { min-height: 100px; font-size: 15px; }
}

/* End of style.css */
        
    </style>
</head>

<body>

<div id="app">

    <!-- Display Panel -->
    <div id="display-container">
        <textarea id="expression-display" spellcheck="false"></textarea>
        <div id="result-display"></div>
    </div>

    <!-- History Panel -->
    <div id="history-panel">
        <div id="history-title">HISTORY</div>
        <div id="history-list"></div>
    </div>

    <!-- Memory Panel -->
    <div id="memory-panel">
        <div id="memory-title">MEMORY</div>
        <div id="memory-list"></div>
        <div id="memory-controls">
            <button class="mem-btn" data-action="MC">MC</button>
            <button class="mem-btn" data-action="MR">MR</button>
            <button class="mem-btn" data-action="M+">M+</button>
            <button class="mem-btn" data-action="M-">M-</button>
        </div>
    </div>

    <!-- Keypad -->
    <div id="keypad">

        <!-- Row 1 -->
        <button class="btn fn" data-fn="clear">AC</button>
        <button class="btn fn" data-fn="del">DEL</button>
        <button class="btn fn" data-fn="copy">COPY</button>
        <button class="btn op" data-insert="/">÷</button>

        <!-- Row 2 -->
        <button class="btn num" data-insert="7">7</button>
        <button class="btn num" data-insert="8">8</button>
        <button class="btn num" data-insert="9">9</button>
        <button class="btn op" data-insert="*">×</button>

        <!-- Row 3 -->
        <button class="btn num" data-insert="4">4</button>
        <button class="btn num" data-insert="5">5</button>
        <button class="btn num" data-insert="6">6</button>
        <button class="btn op" data-insert="-">−</button>

        <!-- Row 4 -->
        <button class="btn num" data-insert="1">1</button>
        <button class="btn num" data-insert="2">2</button>
        <button class="btn num" data-insert="3">3</button>
        <button class="btn op" data-insert="+">+</button>

        <!-- Row 5 -->
        <button class="btn num" data-insert="0">0</button>
        <button class="btn num" data-insert=".">.</button>
        <button class="btn eq" data-fn="evaluate">=</button>
    </div>

</div>

<script>
   
/* main.js
   Core logic: input system, display updates, live evaluation pipeline,
   history + memory, error handling, UI events, keyboard support.
*/

import { parseExpression } from "./math-engine/parser.js";
import { Algebra } from "./math-engine/algebra.js";
import { Calculus } from "./math-engine/calculus.js";
import { Trig } from "./math-engine/trig.js";
import { ComplexOps } from "./math-engine/complex.js";
import { MatrixOps } from "./math-engine/matrices.js";
import { Stats } from "./math-engine/statistics.js";
import { Units } from "./math-engine/units.js";

const exprDisplay = document.getElementById("expression-display");
const resultDisplay = document.getElementById("result-display");
const historyList = document.getElementById("history-list");
const memoryList = document.getElementById("memory-list");

let memoryValue = 0;

// Inject engine
const engine = {
    algebra: Algebra,
    calculus: Calculus,
    trig: Trig,
    complex: ComplexOps,
    matrix: MatrixOps,
    stats: Stats,
    units: Units
};

/* ------------ INPUT INSERTION ------------ */
function insertText(txt) {
    const start = exprDisplay.selectionStart;
    const end = exprDisplay.selectionEnd;
    const current = exprDisplay.value;

    exprDisplay.value = current.slice(0, start) + txt + current.slice(end);
    exprDisplay.selectionStart = exprDisplay.selectionEnd = start + txt.length;

    updateLive();
}

/* ------------ EVALUATION ------------ */
function evaluateExpression() {
    try {
        const code = exprDisplay.value.trim();
        if (code === "") return;

        const ast = parseExpression(code);
        const result = ast.evaluate(engine);

        pushHistory(code, result);
        renderResult(result);

    } catch (err) {
        renderError(err.message || "ERROR");
    }
}

function updateLive() {
    try {
        const code = exprDisplay.value.trim();
        if (code.length === 0) {
            resultDisplay.textContent = "";
            return;
        }
        const ast = parseExpression(code);
        const result = ast.evaluate(engine);
        renderResult(result);
    } catch {
        // silent errors during live update
        resultDisplay.textContent = "";
    }
}

/* ------------ RENDER ------------ */
function renderResult(value) {
    resultDisplay.classList.remove("result-error");
    resultDisplay.textContent = formatOutput(value);
}

function renderError(msg) {
    resultDisplay.classList.add("result-error");
    resultDisplay.textContent = msg;
}

function formatOutput(val) {
    if (typeof val === "number") {
        if (Math.abs(val) >= 1e9 || Math.abs(val) <= 1e-9 && val !== 0)
            return val.toExponential(12);
        return val.toPrecision(12);
    }
    if (Array.isArray(val)) return JSON.stringify(val);
    if (val && typeof val === "object" && val.toString) return val.toString();
    return String(val);
}

/* ------------ HISTORY ------------ */
function pushHistory(expr, value) {
    const item = document.createElement("div");
    item.className = "history-item";

    const left = document.createElement("div");
    left.className = "expr";
    left.textContent = expr;

    const right = document.createElement("div");
    right.className = "value";
    right.textContent = formatOutput(value);

    item.appendChild(left);
    item.appendChild(right);

    item.onclick = () => {
        exprDisplay.value = expr;
        updateLive();
    };

    historyList.prepend(item);
}

/* ------------ MEMORY ------------ */
function updateMemoryList() {
    memoryList.textContent = formatOutput(memoryValue);
}

function memoryAction(action) {
    try {
        const val = parseFloat(resultDisplay.textContent);
        if (isNaN(val) && action !== "MC" && action !== "MR") return;

        switch (action) {
            case "MC": memoryValue = 0; break;
            case "MR": exprDisplay.value += memoryValue; break;
            case "M+": memoryValue += val; break;
            case "M-": memoryValue -= val; break;
        }
        updateMemoryList();
    } catch {}
}

/* ------------ BUTTON HANDLERS ------------ */
document.querySelectorAll("[data-insert]").forEach(btn => {
    btn.onclick = () => insertText(btn.dataset.insert);
});

document.querySelectorAll("[data-fn]").forEach(btn => {
    btn.onclick = () => {
        const fn = btn.dataset.fn;
        if (fn === "clear") {
            exprDisplay.value = "";
            resultDisplay.textContent = "";
        }
        if (fn === "del") {
            const v = exprDisplay.value;
            exprDisplay.value = v.substring(0, v.length - 1);
            updateLive();
        }
        if (fn === "copy") navigator.clipboard.writeText(resultDisplay.textContent);
        if (fn === "evaluate") evaluateExpression();
    };
});

document.querySelectorAll(".mem-btn").forEach(btn => {
    btn.onclick = () => memoryAction(btn.dataset.action);
});

/* ------------ KEYBOARD ------------ */
document.addEventListener("keydown", e => {
    if (e.key === "Enter") { evaluateExpression(); e.preventDefault(); }
    if (e.key === "Escape") { exprDisplay.value = ""; resultDisplay.textContent = ""; }
    if (e.key.length === 1) updateLive();
});

/* ------------ INIT ------------ */
updateMemoryList();
updateLive();
    
</script>

</body>
</html>
